<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="default">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="常见的 CTR 预估模型有：  LR / 决策树系列 Embedding + 低阶交叉 + MLP：FM / DeepFM / NFM / FNN 系列 Embedding + 高阶交叉 + MLP：W&amp;amp;D / DCN / xDeepFM 系列 Attention：RNN CTR / DIN / DIIN / DIEN / CrossMedia / AutoInt（Multi-head S">
<meta property="og:type" content="article">
<meta property="og:title" content="deep-ctr-models">
<meta property="og:url" content="http://liuslevis.github.io/2019/04/25/deep-ctr-models/index.html">
<meta property="og:site_name" content="davidlau&#39;s blog">
<meta property="og:description" content="常见的 CTR 预估模型有：  LR / 决策树系列 Embedding + 低阶交叉 + MLP：FM / DeepFM / NFM / FNN 系列 Embedding + 高阶交叉 + MLP：W&amp;amp;D / DCN / xDeepFM 系列 Attention：RNN CTR / DIN / DIIN / DIEN / CrossMedia / AutoInt（Multi-head S">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-f42029bed447f4a628ca540b1da53eee_720w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-a893a331c3556046be1be7771b2cb1a9_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-3a431f5787105e2463cd8d16295c8275_1440w.png">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-309f6d48a026e27b318f4650568c5069_1440w.png">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-7d939bff9eac9cc26d005a0c9cd76b28_1440w.png">
<meta property="og:image" content="https://2.bp.blogspot.com/-wkrmRibw_GM/V3Mg3O3Q0-I/AAAAAAAABG0/Jm3Nl4-VcYIJ44dA5nSz6vpTyCKF2KWQgCKgB/s1600/image03.png">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-3e97d59af6df3e7e859600f055e175eb_720w.jpg">
<meta property="og:image" content="http://xudongyang.coding.me/dcn/dcn.png">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-e54f2488dd071ae026aee04d6f261a65_hd.jpg">
<meta property="og:image" content="https://www.researchgate.net/profile/Gang_Fu19/publication/321379962/figure/fig1/AS:566843195826177@1512157357850/Visualization-of-a-cross-layer.png">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-1c7cf8fe8fed03bdf5e8740b9334f491_hd.jpg">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-96bfc6e3739c465e4bc7d125c96e9bee_hd.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-4651d69213d29cfbbbab8e6ce188b1a4_hd.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-1e03363fea7172503b888f8436fad8d7_hd.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-e3f4ee9d263aaffedb19a9953639a870_hd.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-c90194ec98ec1c861e8cf61d8a9719df_720w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-358687b8a233f8605a579bf51238e8b1_hd.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-ad38503b7210acb43f78acf515c0dc7c_720w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-c47b92b0c2035fa7a8bec088964f4dd3_hd.png">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-ece03d4954ff71e3fd98cce214eff18b_hd.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-3297a00ff2a0014cfcbfaaf2700f8f64_720w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/v2-d8cca9bb1bbe48e65a77c86451aa3e1c_b.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-59adaaf81958514ffb44af2c72251918_hd.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-3c017ed21a41058b9b400c17066160e8_hd.jpg">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=l">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=l%2B1+">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=l%2B1+">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=H">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=T">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=O%28mTH%5E2%29">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=O%28mDH%2BTH%5E2%29">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=D">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=%5Cbm%7BW%7D">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=L">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=O%28mH%5E2DT%29">
<meta property="og:image" content="https://www.zhihu.com/equation?tex=O%28mDH%2BTH%5E2%29">
<meta property="og:image" content="http://fanding.xyz/img/ZH01.png">
<meta property="og:image" content="http://fanding.xyz/img/ZH09.jpg">
<meta property="og:image" content="http://fanding.xyz/img/ZH11.jpg">
<meta property="og:image" content="http://fanding.xyz/img/ZH14.jpg">
<meta property="og:image" content="http://fanding.xyz/img/ZH16.jpg">
<meta property="og:image" content="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018a/0eecfcca.png">
<meta property="og:image" content="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018a/25c00d5c.png">
<meta property="og:image" content="https://camo.githubusercontent.com/f7aa2ff476e75c0a7f4f53686f6f0767ce495d63/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f33363135342f313534313939343933383138362d36356637656562632d623234362d346661312d396433352d3563616439653232613038642e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/6aa6099c85d394dab701dc64dd658d72eaa79919/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f363039382f313534323333373737373130312d65613934316136342d346636632d343932322d383136352d6238626364653537376239612e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/914b722021ba8f2c017add753a85744c15ff4365/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f33363135342f313534313939363430363830372d33376361326662332d373765312d346330352d396437312d3739313665643936646136322e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/e330757cabd23dc23b86af76fe017630f53fc6db/687474703a2f2f617461322d696d672e636e2d68616e677a686f752e696d672d7075622e616c6979756e2d696e632e636f6d2f33353531393330373030353164393665626463653033383738376564396439332e706e67">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-107eed8fcd5b72f0bbe8464bd2471fc4_hd.jpg">
<meta property="og:image" content="http://www.semocean.com/wp-content/uploads/2019/08/Screenshot_20190818_114444-1024x359.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-2bcd969359e25cb761e83dbe7fd74df7_720w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-bc9273d3a93930afa65ee82265769347_b.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-ada85658bdd40c5e19c41fd76f424c0b_720w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-6c6aa2c6395a51f764702cfac4403d68_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-9eefb5bb8fbf762f82cd614feb91d35f_1200x500.jpg">
<meta property="og:image" content="https://picb.zhimg.com/80/v2-83603bac70ce5c70f21bfaade37e63ec_720w.jpg">
<meta property="og:image" content="https://picb.zhimg.com/80/v2-b3c0a3b076a3964b13390609c2a73aae_720w.jpg">
<meta property="og:image" content="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf73AUlUhNfXWBdaUOPKMQnKXgp4Atsbbf5ZIC6SFEukTCOmiclDR7pqsw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1">
<meta property="og:image" content="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf7TeCnvu4Z20Vb9Dictz4a2evAuNBHScxAibnsGqGCiciaavSoicxV8odwcdQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1">
<meta property="og:image" content="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf7BnZa3guBkDRP3mFl76uv8rgKbyj5ibP087f9W24YchicKPq57AjCKRmA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1">
<meta property="og:image" content="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf72zIYUP8TqWrLXRgbvm4kwGWTiav8Rbkib8SfRibUMwVvVOiaqTkoEhSbvw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1">
<meta property="og:image" content="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf7fSnaSYwTgpCw1Ekb74YdOgnicOqNg0pdEicKyxLpqKez8862gEVUOkJA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-094bdca7184cf02020397df2a9abe67a_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-2b62937c0c80ef66431df9c343bfb90b_1440w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-cb6163a762b848a15bb35b24f2e1af27_720w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-cb31e1f977b0e68c9df0e50019d848ce_720w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-c578c5e506e202483c64fdac94281d4f_720w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-aec2056823ac4e84ca30c2cb0c83be39_720w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-228928089f16b82d1e5fd2016b7683fb_720w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-f21bd3e71e00f6cff30096208d3ec1fb_720w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-d1ab9004ab268a08b471632208267424_720w.jpg">
<meta property="og:updated_time" content="2020-11-02T15:04:21.452Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="deep-ctr-models">
<meta name="twitter:description" content="常见的 CTR 预估模型有：  LR / 决策树系列 Embedding + 低阶交叉 + MLP：FM / DeepFM / NFM / FNN 系列 Embedding + 高阶交叉 + MLP：W&amp;amp;D / DCN / xDeepFM 系列 Attention：RNN CTR / DIN / DIIN / DIEN / CrossMedia / AutoInt（Multi-head S">
<meta name="twitter:image" content="https://pic3.zhimg.com/80/v2-f42029bed447f4a628ca540b1da53eee_720w.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://liuslevis.github.io/2019/04/25/deep-ctr-models/"/>





  <title>deep-ctr-models | davidlau's blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1f9568aea795d9674618be7bae3ab784";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">davidlau's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://liuslevis.github.io/2019/04/25/deep-ctr-models/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="davidlau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="davidlau's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">deep-ctr-models</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-25T16:12:32+08:00">
                2019-04-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>常见的 CTR 预估模型有：</p>
<ul>
<li>LR / 决策树系列</li>
<li>Embedding + 低阶交叉 + MLP：FM / DeepFM / NFM / FNN 系列</li>
<li>Embedding + 高阶交叉 + MLP：W&amp;D / DCN / xDeepFM 系列</li>
<li>Attention：RNN CTR / <a href="https://github.com/alibaba/x-deeplearning/wiki/%E6%B7%B1%E5%BA%A6%E5%85%B4%E8%B6%A3%E7%BD%91%E7%BB%9C(DIN)" target="_blank" rel="noopener">DIN</a> / DIIN / <a href="https://github.com/alibaba/x-deeplearning/wiki/%E7%94%A8%E6%88%B7%E5%85%B4%E8%B6%A3%E6%BC%94%E5%8C%96%E6%A8%A1%E5%9E%8B(DIEN)" target="_blank" rel="noopener">DIEN</a> / CrossMedia / AutoInt（Multi-head Self-attention）</li>
<li>多任务联合建模： ESMM / ESM^2 / <a href="https://arxiv.org/pdf/1805.10727.pdf" target="_blank" rel="noopener">DUPN</a></li>
<li>双塔模型 DSSM 系列</li>
</ul>
<p>深度 CTR 预估模型有：</p>
<ul>
<li>
<p>Wide&amp;Deep 16 兼具泛化性和记忆性的联合优化，cross product 进行特征交叉</p>
</li>
<li>
<p>DCN 17 使用 CrossNet 拟合任意高阶元素级交互（bit-wise 、上 1 层）</p>
</li>
<li>
<p>DeepFM 17 使用 FM 拟合 emb 向量的二阶交互</p>
<ul>
<li>
<p>NFM 17 在 FM 层后增加了 Bi-Interaction Layer 完成池化和特征交叉、 增加 Dense 层</p>
</li>
<li>
<p>AFM 17 在 NFM 结构增加 attention 机制学习交互特征的权重</p>
</li>
<li>
<p>xDeepFM 18 使用 CIN 进行向量级别、高阶元素的交叉（vector-wise、上 n 层）</p>
</li>
</ul>
</li>
<li>
<p>FNN 07 用 FM 预训练 emb 向量 + Dense 结构</p>
<ul>
<li>
<p>CCPM</p>
</li>
<li>
<p>PNN SNN</p>
</li>
<li>
<p>FGCNN</p>
<p>FiBiNet 19 结合特征重要性和双线性特征交互</p>
</li>
</ul>
</li>
<li>
<p>YouTubeDNN 16 通过 pooling 引入用户历史行为序列</p>
<ul>
<li>DIN 通过 attention pooling  引入带权重的用户历史行为序列</li>
<li>DIIN 在 DIN 基础上增加图片特征
<ul>
<li>DIEN 19 引入循环网络和辅助 loss 捕获用户兴趣的动态变化</li>
<li><a href="https://arxiv.org/pdf/1905.06482.pdf" target="_blank" rel="noopener">DSIN</a> 19 基于用户行为序列同构 / 异构差异的建模</li>
<li><a href="https://arxiv.org/abs/1906.03776" target="_blank" rel="noopener">DSTN</a> 19 引入上下文展示广告和历史点击、为点击广告辅助预测</li>
<li><a href="https://arxiv.org/pdf/1905.09248.pdf" target="_blank" rel="noopener">MIMN</a> 19 超长历史行为序列建模</li>
<li>ESMM 18 通过 pCTR pCVR 联合模型共享权制，多任务学习，解决转化样本有偏、稀疏问题</li>
<li>ESM^2 18 增加加购、收藏等多目标</li>
</ul>
</li>
</ul>
</li>
<li>
<p>AutoInt 19 引入 Transformer 中的 multi-head attention 机制</p>
</li>
<li>
<p>BST 19 引入用户行为序列 + Transformer</p>
</li>
</ul>
<h2 id="xgb"><a class="markdownIt-Anchor" href="#xgb"></a> XGB</h2>
<p>优化瓶颈</p>
<ol>
<li>树型结构导致无法增量训练（FTRL）</li>
<li>稀疏的类别特征无法有效学习，onehot 后增加计算开销，且每个分类上数据量小（LR 记忆性）</li>
<li>特征交叉能力有限</li>
</ol>
<h2 id="gbdt-lr"><a class="markdownIt-Anchor" href="#gbdt-lr"></a> GBDT + LR</h2>
<p>Facebook ADKDD 2014</p>
<p>GBDT 叶子结点作为 LR 输入，通过 GBDT 做特征组合引入非线性。</p>
<h2 id="fm"><a class="markdownIt-Anchor" href="#fm"></a> FM</h2>
<p><img src="https://pic3.zhimg.com/80/v2-f42029bed447f4a628ca540b1da53eee_720w.jpg" alt="img"></p>
<h2 id="deepfm"><a class="markdownIt-Anchor" href="#deepfm"></a> DeepFM</h2>
<p>Huawei 2016</p>
<p><img src="https://pic2.zhimg.com/80/v2-a893a331c3556046be1be7771b2cb1a9_1440w.jpg" alt="img"></p>
<p>为了同时利用low-order和high-order特征，DeepFM包含FM和DNN两部分，两部分共享输入特征。对于特征i，标量wi是其1阶特征的权重，该特征和其他特征的交互影响用隐向量Vi来表示。Vi输入到FM模型获得特征的2阶表示，输入到DNN模型得到high-order高阶特征。模型联合训练，结果可表示为：</p>
<p><img src="https://pic2.zhimg.com/80/v2-3a431f5787105e2463cd8d16295c8275_1440w.png" alt="img"></p>
<p><img src="https://pic2.zhimg.com/80/v2-309f6d48a026e27b318f4650568c5069_1440w.png" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-7d939bff9eac9cc26d005a0c9cd76b28_1440w.png" alt="img"></p>
<h2 id="widedeep"><a class="markdownIt-Anchor" href="#widedeep"></a> Wide&amp;Deep</h2>
<p>Google DLRS 2016</p>
<p><img src="https://2.bp.blogspot.com/-wkrmRibw_GM/V3Mg3O3Q0-I/AAAAAAAABG0/Jm3Nl4-VcYIJ44dA5nSz6vpTyCKF2KWQgCKgB/s1600/image03.png" alt="img"></p>
<p>Wide：向量点积特征，具有记忆性。缺点：需要特征工程，不能覆盖未见的 query-item 特征，泛化差。</p>
<p>Deep：引入低维的 embedding，对未见的 query - item 具有泛化性。注意当 query - item 矩阵是稀疏且高秩时（如每个用户的兴趣很窄且小众），较难学习 embedding，出现过度泛化现象。此时需要 Wide 的记忆性来缓解。</p>
<p>训练：joint training 而不是 ensemble。相对而言，joint training 对子模型需要更少的模型容量 / 参数。Deep 泛化部分的不足，仅仅需要少量的 Wide 来弥补。Wide 用 FTRL，Deep 用 AdaGrad。其中 wide 部分类似 ResNet 的 residual shortcut。</p>
<p>工程：共使用 500 Bi 样本。对新样本，增量训练。上线前两个模型预测结果对比，做健全性检验（sanity-check）。</p>
<p>推理公式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>(</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mrow><mi>x</mi></mrow><mo>)</mo><mo>=</mo><mi>σ</mi><mo>(</mo><msubsup><mrow><mi>w</mi></mrow><mrow><mi>w</mi><mi>i</mi><mi>d</mi><mi>e</mi></mrow><mi>T</mi></msubsup><mo>[</mo><mrow><mi>x</mi></mrow><mo separator="true">,</mo><mi>ϕ</mi><mo>(</mo><mrow><mi>x</mi></mrow><mo>)</mo><mo>]</mo><mo>+</mo><msubsup><mrow><mi>w</mi></mrow><mrow><mi>d</mi><mi>e</mi><mi>e</mi><mi>p</mi></mrow><mi>T</mi></msubsup><mi>a</mi><mo>(</mo><msub><mi>l</mi><mi>f</mi></msub><mo>)</mo><mo>+</mo><mi>b</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">P(Y=1|\mathbb{x})=\sigma (\mathbb{w}^T_{wide}[\mathbb{x},\phi(\mathbb{x})]+\mathbb{w}^T_{deep}a(l_f)+b)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.891331em;"></span><span class="strut bottom" style="height:1.274439em;vertical-align:-0.383108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mord mathrm">∣</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class=""><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mord mathit">i</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">[</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span><span class="mpunct">,</span><span class="mord mathit">ϕ</span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mbin">+</span><span class=""><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span><span class="vlist"><span style="top:0.24700000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">e</span><span class="mord mathit">p</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">a</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit">b</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">σ</span></span></span></span> 是 sigmoid 函数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mo>⋅</mo><mo separator="true">,</mo><mo>⋅</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">[\cdot,\cdot ]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord">⋅</span><span class="mpunct">,</span><span class="mord">⋅</span><span class="mclose">]</span></span></span></span> 表示特征拼接。</p>
<p>向量点积：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><msub><mi>ϕ</mi><mi>k</mi></msub><mo>(</mo><mrow><mi>x</mi></mrow><mo>)</mo><mo>=</mo><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>d</mi></msubsup><msubsup><mi>x</mi><mi>i</mi><mrow><msub><mi>c</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow></msubsup></mrow></mtd></mtr><mtr><mtd><mrow><msub><mi>c</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>∈</mo><mo>{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>}</mo><mo separator="true">,</mo><mrow><mi>x</mi></mrow><mo>=</mo><mo>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>d</mi></msub><mo>]</mo></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{aligned}
\phi_k(\mathbb{x})=\prod_{i=1}^d x_i^{c_{ki}}\\
c_{ki}\in \{0,1\}, \mathbb{x} = [x_1,x_2,...,x_d]
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.4068910000000003em;"></span><span class="strut bottom" style="height:4.313782em;vertical-align:-1.906891em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-0.570778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">ϕ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∏</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.27686399999999994em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span style="top:-0.4506599999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span class="mord mathit">c</span><span class="vlist"><span style="top:0.15122857142857138em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord scriptscriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:1.5468909999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">c</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class="mopen">{</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">}</span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span><span class="mrel">=</span><span class="mopen">[</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">]</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是某个特征， <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">c_{ki}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">c</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 如果为 1 表示 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>ϕ</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">\phi_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">ϕ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 变换的一部分。</p>
<p>向量点击可以进行特征组合，引入非线性，如 <code>AND(gender=female, language=en)</code> 这个特征，当且仅当这个用户的性别为 female，语言为 en 的时候，这个特征值才为 1，其他情况都为 0。</p>
<h2 id="dcn-17"><a class="markdownIt-Anchor" href="#dcn-17"></a> DCN 17’</h2>
<p><a href="http://xudongyang.coding.me/dcn/" target="_blank" rel="noopener">http://xudongyang.coding.me/dcn/</a></p>
<p><img src="https://pic4.zhimg.com/80/v2-3e97d59af6df3e7e859600f055e175eb_720w.jpg" alt="img"></p>
<p>ADKDD 17’ <a href="https://arxiv.org/pdf/1708.05123.pdf" target="_blank" rel="noopener">PDF</a>，类似于Wide &amp; Deep Network(WDL)，是用复杂网络预估CTR的一种方法。</p>
<p>与 DeepFM 相比，可以自动高阶特征：</p>
<ol>
<li>通过设置交叉网络深度，能够限定交叉阶数</li>
<li>每层交叉时，做第零层与第一层的交叉 &amp; 学习残差</li>
</ol>
<p><img src="http://xudongyang.coding.me/dcn/dcn.png" alt="img"></p>
<p>其中每个 cross layer，通过学习函数 f 拟合层间残差</p>
<p><img src="https://pic2.zhimg.com/80/v2-e54f2488dd071ae026aee04d6f261a65_hd.jpg" alt="img"></p>
<p><img src="https://www.researchgate.net/profile/Gang_Fu19/publication/321379962/figure/fig1/AS:566843195826177@1512157357850/Visualization-of-a-cross-layer.png" alt="img"></p>
<p>论文在 movielen 数据集上，与 LR FM DNN DeepCrossing 做对比。没有与 W&amp;D 做对比的原因是 W&amp;D 需要领域知识进行特征工程。没有与 DeepFM 对比，是同时期工作。</p>
<h2 id="fnn-snn-pnn"><a class="markdownIt-Anchor" href="#fnn-snn-pnn"></a> FNN &amp; SNN &amp; PNN</h2>
<p><strong>Feedforward Neural Network, ANN 2007</strong></p>
<p>FM 预训练 emb 向量 + DNN 结构，无 embedding</p>
<p><strong>Self-Normalizing Neural Network, NIPS 2017</strong></p>
<p><img src="https://pic2.zhimg.com/80/v2-1c7cf8fe8fed03bdf5e8740b9334f491_hd.jpg" alt="img"></p>
<p><img src="https://pic3.zhimg.com/80/v2-96bfc6e3739c465e4bc7d125c96e9bee_hd.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-4651d69213d29cfbbbab8e6ce188b1a4_hd.jpg" alt="img"></p>
<p><strong>Product-based Neural Networks, ICDM 2016</strong></p>
<p><img src="https://pic4.zhimg.com/80/v2-1e03363fea7172503b888f8436fad8d7_hd.jpg" alt="img"></p>
<p>PNN 的 Embedding 和 Hiden Layer 1之间进行一次 <strong>inner / outer production</strong>，效果不错但增加了全连接规模导致训练较慢。</p>
<h2 id="nfm-17"><a class="markdownIt-Anchor" href="#nfm-17"></a> NFM 17’</h2>
<p>Neral Factorization Machine, arxiv 2017 <a href="https://arxiv.org/pdf/1708.05027v1.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>基于 FM 改进，在 FM 层后增加了 Dense 层 <a href="https://zhuanlan.zhihu.com/p/40135103" target="_blank" rel="noopener">NFM与AFM用于CTR预估</a></p>
<p><img src="https://pic1.zhimg.com/80/v2-e3f4ee9d263aaffedb19a9953639a870_hd.jpg" alt="img"></p>
<p><img src="https://pic4.zhimg.com/80/v2-c90194ec98ec1c861e8cf61d8a9719df_720w.jpg" alt="img"></p>
<p>与 YoutubeDNN 的 AVG Pooling 不同，NFM 通过 <strong>Bi-Interaction Pooling</strong> 完成池化和特征交叉：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>B</mi><mi>I</mi></mrow></msub><mo>(</mo><msub><mi>V</mi><mi>x</mi></msub><mo>)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi></mrow></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>n</mi></mrow></msubsup><msub><mi>x</mi><mi>i</mi></msub><msub><mi>v</mi><mi>i</mi></msub><mo>⊙</mo><msub><mi>x</mi><mi>j</mi></msub><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">f_{BI}(V_x)=\sum_{i=1}^{n} \sum_{j=i+1}^{n} x_i v_i \odot x_j v_j
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.6513970000000007em;"></span><span class="strut bottom" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit" style="margin-right:0.07847em;">I</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">=</span><span class="mord mathit">i</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000254801em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">⊙</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是第 i 维特征，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是对应 embedding 矩阵，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>⊙</mo></mrow><annotation encoding="application/x-tex">\odot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.58333em;"></span><span class="strut bottom" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord">⊙</span></span></span></span> 是 element-wise product (outer product)。</p>
<p>实现代码：</p>
<p><a href="https://github.com/nzc/dnn_ctr/blob/master/model/NFM.py" target="_blank" rel="noopener">https://github.com/nzc/dnn_ctr/blob/master/model/NFM.py</a></p>
<p><a href="https://github.com/lambdaji/tf_repos/blob/master/deep_ctr/Model_pipeline/NFM.py" target="_blank" rel="noopener">https://github.com/lambdaji/tf_repos/blob/master/deep_ctr/Model_pipeline/NFM.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"BiInter-part"</span>):</span><br><span class="line">    embeddings = tf.nn.embedding_lookup(Feat_Emb, feat_ids)         <span class="comment"># None * F * K</span></span><br><span class="line">    feat_vals = tf.reshape(feat_vals, shape=[<span class="number">-1</span>, field_size, <span class="number">1</span>])</span><br><span class="line">    embeddings = tf.multiply(embeddings, feat_vals)                 <span class="comment"># vij * xi</span></span><br><span class="line">    sum_square_emb = tf.square(tf.reduce_sum(embeddings,<span class="number">1</span>))</span><br><span class="line">    square_sum_emb = tf.reduce_sum(tf.square(embeddings),<span class="number">1</span>)</span><br><span class="line">    deep_inputs = <span class="number">0.5</span>*tf.subtract(sum_square_emb, square_sum_emb)   <span class="comment"># None * K</span></span><br><span class="line">    <span class="comment"># DeepFM 没有 subtract 计算，是主要区别</span></span><br></pre></td></tr></table></figure>
<p>论文在 MovieLen 数据集合与 WDL DCN 模型做对比。</p>
<h3 id="nffm-18"><a class="markdownIt-Anchor" href="#nffm-18"></a> NFFM 18’</h3>
<p>NFM 的变种，在 Bi-Interaction 中将 FM 替换为 FFM</p>
<p>实现 <a href="https://github.com/guoday/ctrNet-tool/blob/master/models/nffm.py" target="_blank" rel="noopener">https://github.com/guoday/ctrNet-tool/blob/master/models/nffm.py</a></p>
<p>腾讯 2018 Lookalike 第七名实现 <a href="https://github.com/guoday/Tencent2018_Lookalike_Rank7th" target="_blank" rel="noopener">https://github.com/guoday/Tencent2018_Lookalike_Rank7th</a></p>
<p>腾讯 2019 广告比赛预赛第一名实现 <a href="https://github.com/guoday/Tencent2019_Preliminary_Rank1st" target="_blank" rel="noopener">https://github.com/guoday/Tencent2019_Preliminary_Rank1st</a></p>
<h2 id="afm-17"><a class="markdownIt-Anchor" href="#afm-17"></a> AFM 17’</h2>
<p>Attentional FM, arxiv 2017 <a href="https://arxiv.org/pdf/1708.04617.pdf" target="_blank" rel="noopener">PDF</a>, 浙江大学 Jun Xiao et. al.</p>
<p><a href="https://zhuanlan.zhihu.com/p/38517948" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38517948</a></p>
<p><img src="https://pic2.zhimg.com/80/v2-358687b8a233f8605a579bf51238e8b1_hd.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-ad38503b7210acb43f78acf515c0dc7c_720w.jpg" alt="img"></p>
<p>NFM 的改进，增加 attention 机制（pair-wise interaction + attention-based pooling），学习交叉相的权重，对无用的交叉项降权，减少噪声；同时可做重要性分析。</p>
<p>训练：先冻结 attension net 训练 FM embedding；然后固定 FM embedding 训练 attention net。</p>
<p>实现代码：</p>
<p><a href="https://github.com/lambdaji/tf_repos/blob/master/deep_ctr/Model_pipeline/AFM.py" target="_blank" rel="noopener">https://github.com/lambdaji/tf_repos/blob/master/deep_ctr/Model_pipeline/AFM.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"Pairwise-Interaction-Layer"</span>):</span><br><span class="line">    embeddings = tf.nn.embedding_lookup(Feat_Emb, feat_ids) <span class="comment"># None * F * K</span></span><br><span class="line">    feat_vals = tf.reshape(feat_vals, shape=[<span class="number">-1</span>, field_size, <span class="number">1</span>])</span><br><span class="line">    embeddings = tf.multiply(embeddings, feat_vals) <span class="comment">#vij*xi</span></span><br><span class="line"></span><br><span class="line">    num_interactions = field_size*(field_size<span class="number">-1</span>)/<span class="number">2</span></span><br><span class="line">    element_wise_product_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, field_size):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>, field_size):</span><br><span class="line">            element_wise_product_list.append(tf.multiply(embeddings[:,i,:], embeddings[:,j,:]))</span><br><span class="line">    element_wise_product = tf.stack(element_wise_product_list) <span class="comment"># (F*(F-1)) * None * K</span></span><br><span class="line">    element_wise_product = tf.transpose(element_wise_product, perm=[<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>])	<span class="comment"># None * (F*(F-1)) * K</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"Attention-part"</span>):</span><br><span class="line">    deep_inputs = tf.reshape(element_wise_product, shape=[<span class="number">-1</span>, embedding_size]) <span class="comment"># (None * (F*(F-1))) * K</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(layers)):</span><br><span class="line">        deep_inputs = tf.contrib.layers.fully_connected(inputs=deep_inputs, num_outputs=layers[i], weights_regularizer=tf.contrib.layers.l2_regularizer(l2_reg), scope=<span class="string">'mlp%d'</span> % i)</span><br><span class="line"></span><br><span class="line">    aij = tf.contrib.layers.fully_connected(inputs=deep_inputs, num_outputs=<span class="number">1</span>, activation_fn=tf.identity, weights_regularizer=tf.contrib.layers.l2_regularizer(l2_reg), scope=<span class="string">'attention_out'</span>)<span class="comment"># (None * (F*(F-1))) * 1</span></span><br><span class="line"></span><br><span class="line">    aij_softmax = tf.nn.softmax(tf.reshape(aij, shape=[<span class="number">-1</span>, num_interactions, <span class="number">1</span>]), dim=<span class="number">1</span>, name=<span class="string">'attention_soft'</span>)</span><br><span class="line">    <span class="keyword">if</span> mode == tf.estimator.ModeKeys.TRAIN:</span><br><span class="line">        aij_softmax = tf.nn.dropout(aij_softmax, keep_prob=dropout[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"Attention-based-Pooling"</span>):</span><br><span class="line">    y_emb = tf.reduce_sum(tf.multiply(aij_softmax, element_wise_product), <span class="number">1</span>) <span class="comment"># None * K</span></span><br><span class="line">    <span class="keyword">if</span> mode == tf.estimator.ModeKeys.TRAIN:</span><br><span class="line">        y_emb = tf.nn.dropout(y_emb, keep_prob=dropout[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    y_d = tf.contrib.layers.fully_connected(inputs=y_emb, num_outputs=<span class="number">1</span>, activation_fn=tf.identity, weights_regularizer=tf.contrib.layers.l2_regularizer(l2_reg), scope=<span class="string">'deep_out'</span>) <span class="comment"># None * 1</span></span><br><span class="line">    y_deep = tf.reshape(y_d,shape=[<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"AFM-out"</span>):</span><br><span class="line">    y_bias = Global_Bias * tf.ones_like(y_deep, dtype=tf.float32)   <span class="comment"># None * 1</span></span><br><span class="line">    y = y_bias + y_linear + y_deep</span><br><span class="line">    pred = tf.sigmoid(y)</span><br></pre></td></tr></table></figure>
<p>论文在 MovieLens 数据集与 libFM / HOFM / Wide&amp;Deep / DeepCross 算法对比，取得 SOTA 成绩。</p>
<h2 id="deepfm-17"><a class="markdownIt-Anchor" href="#deepfm-17"></a> DeepFM 17’</h2>
<p>Huawei ICJA 2017</p>
<p>输入是高维、稀疏的、连续值离散值混合。</p>
<p><img src="https://pic4.zhimg.com/80/v2-c47b92b0c2035fa7a8bec088964f4dd3_hd.png" alt="img"></p>
<p>对比 FNN PNN W&amp;D 网络结构</p>
<p><img src="https://pic4.zhimg.com/80/v2-ece03d4954ff71e3fd98cce214eff18b_hd.jpg" alt="img"></p>
<p>实现代码（省略 Dropout 和 BN）</p>
<p><a href="https://github.com/lambdaji/tf_repos/blob/master/deep_ctr/Model_pipeline/DeepFM.py" target="_blank" rel="noopener">https://github.com/lambdaji/tf_repos/blob/master/deep_ctr/Model_pipeline/DeepFM.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"First-order"</span>):</span><br><span class="line">    feat_wgts = tf.nn.embedding_lookup(FM_W, feat_ids)              <span class="comment"># None * F * 1</span></span><br><span class="line">    y_w = tf.reduce_sum(tf.multiply(feat_wgts, feat_vals),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"Second-order"</span>):</span><br><span class="line">    embeddings = tf.nn.embedding_lookup(FM_V, feat_ids)             <span class="comment"># None * F * K</span></span><br><span class="line">    feat_vals = tf.reshape(feat_vals, shape=[<span class="number">-1</span>, field_size, <span class="number">1</span>])</span><br><span class="line">    embeddings = tf.multiply(embeddings, feat_vals)                 <span class="comment">#vij*xi</span></span><br><span class="line">    sum_square = tf.square(tf.reduce_sum(embeddings,<span class="number">1</span>))</span><br><span class="line">    square_sum = tf.reduce_sum(tf.square(embeddings),<span class="number">1</span>)</span><br><span class="line">    y_v = <span class="number">0.5</span>*tf.reduce_sum(tf.subtract(sum_square, square_sum),<span class="number">1</span>)	<span class="comment"># None * 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"Deep-part"</span>):</span><br><span class="line">    deep_inputs = tf.reshape(embeddings,shape=[<span class="number">-1</span>,field_size*embedding_size]) <span class="comment"># None * (F*K)</span></span><br><span class="line">    y_deep = tf.contrib.layers.fully_connected(inputs=deep_inputs, num_outputs=<span class="number">1</span>, activation_fn=tf.identity, weights_regularizer=tf.contrib.layers.l2_regularizer(l2_reg), scope=<span class="string">'deep_out'</span>)</span><br><span class="line">    y_d = tf.reshape(y_deep,shape=[<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"DeepFM-out"</span>):</span><br><span class="line">    y_bias = FM_B * tf.ones_like(y_d, dtype=tf.float32)      <span class="comment"># None * 1</span></span><br><span class="line">    y = y_bias + y_w + y_v + y_d</span><br><span class="line">    pred = tf.sigmoid(y)</span><br></pre></td></tr></table></figure>
<h2 id="xdeepfm-18"><a class="markdownIt-Anchor" href="#xdeepfm-18"></a> xDeepFM 18’</h2>
<p>KDD18 <a href="https://arxiv.org/pdf/1803.05170.pdf" target="_blank" rel="noopener">https://arxiv.org/pdf/1803.05170.pdf</a></p>
<p>腾讯广告比赛 19’ 冠军方案 <a href="https://zhuanlan.zhihu.com/p/73062485" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/73062485</a></p>
<p>论文在 Criteo 数据集与 DeepFM WDL PNN DCN 做对比，是目前 AUC 最好的方法。</p>
<p>与 DCN 不同，DCN 在 cross 层进行 bit-wise 的有限高阶特征交叉，不区分 vector field 的概念；xDeepFM 在 CIN 层以 vector-size 进行有限高阶特征交叉。例如，Age Field对应嵌入向量&lt;a1,b1,c1&gt;，Occupation Field对应嵌入向量&lt;a2,b2,c2&gt;，在Cross层，a1,b1,c1,a2,b2,c2会拼接后直接作为输入，即它意识不到Field vector的概念。Cross 以嵌入向量中的单个bit为最细粒度，而FM是以向量为最细粒度学习相关性，即 <strong>vector-wise</strong>。<strong>xDeepFM的动机，正是将FM的vector-wise的思想引入Cross部分</strong>。</p>
<p><img src="https://pic1.zhimg.com/80/v2-3297a00ff2a0014cfcbfaaf2700f8f64_720w.jpg" alt="img"></p>
<p>简而言之：xDeepFM 是实现 <strong>vector-wise、与上n层</strong> 的高阶特征交叉，DCN 每层是 <strong>bit-wise、与上一层</strong> 的高阶特征交叉。</p>
<p><img src="https://pic1.zhimg.com/v2-d8cca9bb1bbe48e65a77c86451aa3e1c_b.jpg" alt="img"></p>
<p><a href="https://zhuanlan.zhihu.com/p/57162373" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/57162373</a></p>
<p><img src="https://pic1.zhimg.com/80/v2-59adaaf81958514ffb44af2c72251918_hd.jpg" alt="img"></p>
<p>其中 CIN 结构下图，其中</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mn>0</mn></msup><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>D</mi></mrow></msup></mrow><annotation encoding="application/x-tex">X^0 \in \mathbb R^{m\times D}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8413309999999999em;"></span><span class="strut bottom" style="height:0.880431em;vertical-align:-0.0391em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class=""><span class="mord mathbb">R</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">m</span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是输入，由 m 个 field， D 维的 embbeding feature 组成。</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">X^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.849108em;"></span><span class="strut bottom" style="height:0.849108em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>  表示第 k 层的输出，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">H_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 表示 k 层的 vector 个数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>⊙</mo></mrow><annotation encoding="application/x-tex">\odot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.58333em;"></span><span class="strut bottom" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord">⊙</span></span></span></span> 表示 hadamard 乘积（逐元素乘）</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>X</mi><mrow><mi>h</mi><mo separator="true">,</mo><mo>∗</mo></mrow><mi>k</mi></msubsup><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><msub><mi>H</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msubsup><mi>W</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mrow><mi>k</mi><mo separator="true">,</mo><mi>h</mi></mrow></msubsup><mo>(</mo><msubsup><mi>X</mi><mrow><mi>i</mi><mo separator="true">,</mo><mo>∗</mo></mrow><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo>⊙</mo><msubsup><mi>X</mi><mrow><mi>j</mi><mo separator="true">,</mo><mo>∗</mo></mrow><mn>0</mn></msubsup><mo>)</mo><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mn>1</mn><mo>×</mo><mi>D</mi></mrow></msup><mo separator="true">,</mo><mtext><mtext> </mtext></mtext><mn>1</mn><mo>≤</mo><mi>h</mi><mo>≤</mo><msub><mi>H</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">X^k_{h,*}=\sum_{i=1}^{H_{k-1}}\sum_{j=1}^m W_{i,j}^{k,h}(X_{i,*}^{k-1} \odot X_{j,*}^0 )\in \mathbb R^{1\times D},\text{ }1\le h \le H_k
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.8868610000000001em;"></span><span class="strut bottom" style="height:3.300638em;vertical-align:-1.4137769999999998em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">h</span><span class="mpunct">,</span><span class="mord">∗</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.3085300000000002em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15122857142857138em;margin-right:0.07142857142857144em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord scriptscriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000254801em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.276864em;margin-left:-0.13889em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-0.480908em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mord mathit">h</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:0.266995em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord">∗</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">⊙</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mord">∗</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">∈</span><span class=""><span class="mord mathbb">R</span><span class="vlist"><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="text mord displaystyle textstyle uncramped"><span class="mord mspace"> </span></span><span class="mord mathrm">1</span><span class="mrel">≤</span><span class="mord mathit">h</span><span class="mrel">≤</span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<p><img src="https://pic1.zhimg.com/80/v2-3c017ed21a41058b9b400c17066160e8_hd.jpg" alt="img"></p>
<p>CIN与Cross的几个主要差异：</p>
<ol>
<li>Cross是bit-wise的，而CIN 是vector-wise的；</li>
<li>在第 <img src="https://www.zhihu.com/equation?tex=l" alt="[公式]"> 层，Cross包含从 1 阶 ～ <img src="https://www.zhihu.com/equation?tex=l%2B1+" alt="[公式]"> 阶 的所有组合特征，而CIN只包含 <img src="https://www.zhihu.com/equation?tex=l%2B1+" alt="[公式]"> 阶的组合特征。相应地，Cross在输出层输出全部结果，而CIN在每层都输出中间结果。</li>
</ol>
<p>复杂度</p>
<p>假设CIN和DNN每层神经元/向量个数都为 <img src="https://www.zhihu.com/equation?tex=H" alt="[公式]"> ，网络深度为 <img src="https://www.zhihu.com/equation?tex=T" alt="[公式]"> 。那么CIN的参数空间复杂度为 <img src="https://www.zhihu.com/equation?tex=O%28mTH%5E2%29" alt="[公式]"> ，普通的DNN为 <img src="https://www.zhihu.com/equation?tex=O%28mDH%2BTH%5E2%29" alt="[公式]"> ，CIN的空间复杂度与输入维度 <img src="https://www.zhihu.com/equation?tex=D" alt="[公式]"> 无关，此外，如果有必要，CIN还可以对权重矩阵 <img src="https://www.zhihu.com/equation?tex=%5Cbm%7BW%7D" alt="[公式]"> 进行 <img src="https://www.zhihu.com/equation?tex=L" alt="[公式]"> 阶矩阵分解从而能降低空间复杂度。</p>
<p>CIN的时间复杂度就不容乐观了，按照上面介绍的计算方式为 <img src="https://www.zhihu.com/equation?tex=O%28mH%5E2DT%29" alt="[公式]"> ，而DNN为<img src="https://www.zhihu.com/equation?tex=O%28mDH%2BTH%5E2%29" alt="[公式]">，<strong>时间复杂度会是CIN的一个主要痛点</strong>。</p>
<p><a href="https://zhuanlan.zhihu.com/p/57162373" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/57162373</a></p>
<h2 id="双塔模型"><a class="markdownIt-Anchor" href="#双塔模型"></a> 双塔模型</h2>
<p><strong>DSMM 13’</strong></p>
<p>是微软 2013 年发表的一个 query / doc 相似度计算模型，思想是将不同的对象映射到同一个语义空间中，利用语义空间中的距离计算相似度。</p>
<p>首先将 query 和 doc 转化成 embedding  向量 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span>，这里针对英文单词提出了 word hash 方法降低计算量（中文不适用）。</p>
<p>接着词向量 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span> 输入 DNN，选取 tanh 作为激活函数，得到 semantic feature <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>；然后 query 和 doc 会进行一次 cos 相似度计算得到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>(</mo><mi>q</mi><mo separator="true">,</mo><msub><mi>D</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">R(q,D_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span>，最后经过 softmax 得到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>(</mo><msub><mi>D</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><mi>Q</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">P(D_i|Q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord mathit">Q</span><span class="mclose">)</span></span></span></span>，其中</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>(</mo><mi>Q</mi><mo separator="true">,</mo><mi>D</mi><mo>)</mo><mo>=</mo><mi>cos</mi><mo>(</mo><msub><mi>y</mi><mi>Q</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>D</mi></msub><mo>)</mo><mo>=</mo><mfrac><mrow><msubsup><mi>y</mi><mi>Q</mi><mi>T</mi></msubsup><msub><mi>y</mi><mi>D</mi></msub></mrow><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mi>y</mi><mi>Q</mi></msub><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mi>y</mi><mi>D</mi></msub><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">R(Q,D)=\cos (y_Q, y_D) =\frac{y_Q^T y_D}{||y_Q||||y_D||}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.64277em;"></span><span class="strut bottom" style="height:2.614878em;vertical-align:-0.972108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit">Q</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mrel">=</span><span class="mop">cos</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">Q</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.6859999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">∣</span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">Q</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord mathrm">∣</span><span class="mord mathrm">∣</span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord mathrm">∣</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.801439em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.275331em;margin-left:-0.03588em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">Q</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>(</mo><mi>D</mi><mi mathvariant="normal">∣</mi><mi>Q</mi><mo>)</mo><mo>=</mo><mfrac><mrow><mi>exp</mi><mo>(</mo><mi>γ</mi><mi>R</mi><mo>(</mo><mi>Q</mi><mo separator="true">,</mo><mi>D</mi><mo>)</mo><mo>)</mo></mrow><mrow><msub><mo>∑</mo><mrow><msup><mi>D</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>∈</mo><mi>D</mi></mrow></msub><mi>exp</mi><mo>(</mo><mi>γ</mi><mi>R</mi><mo>(</mo><mi>Q</mi><mo separator="true">,</mo><msup><mi>D</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>)</mo><mo>)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(D|Q)=\frac{\exp (\gamma R(Q,D))}{\sum_{D&#x27;\in D} \exp(\gamma R(Q,D&#x27;))}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.427em;"></span><span class="strut bottom" style="height:2.44038em;vertical-align:-1.0133800000000002em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathrm">∣</span><span class="mord mathit">Q</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.6860000000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="vlist"><span style="top:0.30001em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="vlist"><span style="top:-0.289em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord scriptscriptstyle cramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mop">exp</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit">Q</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="vlist"><span style="top:-0.289em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mop">exp</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit">Q</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p>损失函数</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>(</mo><mi>w</mi><mo>)</mo><mo>=</mo><mo>−</mo><mi>log</mi><msub><mo>∏</mo><mrow><mo>(</mo><mi>Q</mi><mo separator="true">,</mo><msup><mi>D</mi><mo>+</mo></msup><mo>)</mo></mrow></msub><mi>P</mi><mo>(</mo><msup><mi>D</mi><mo>+</mo></msup><mi mathvariant="normal">∣</mi><mi>Q</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">L(w) = -\log \prod_{(Q,D^+)} P(D^+|Q)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.050005em;"></span><span class="strut bottom" style="height:2.5660100000000003em;vertical-align:-1.516005em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">L</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord">−</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mop op-limits"><span class="vlist"><span style="top:1.241005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mopen">(</span><span class="mord mathit">Q</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="vlist"><span style="top:-0.289em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord">+</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span><span style="top:-0.000005000000000032756em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∏</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="vlist"><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">+</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord mathit">Q</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">Q</span></span></span></span> 是 query， <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>D</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">D^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:0.771331em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">+</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是点击 doc</p>
<p><strong>DSSM</strong></p>
<p><img src="http://fanding.xyz/img/ZH01.png" alt="img"></p>
<p><strong>MultiView-DSSM</strong></p>
<p>共享 item 参数</p>
<p><img src="http://fanding.xyz/img/ZH09.jpg" alt="img"></p>
<p><strong>T-DSSM 16’</strong></p>
<p>MV-DSSM 模型加入 user temporal feature，引入 attention 机制，学习用户的短期兴趣。</p>
<p>难点在于时序特征的设计和训练，使用前应权衡业务对时间序列预测的需求。</p>
<p><img src="http://fanding.xyz/img/ZH11.jpg" alt="img"></p>
<p><strong>YoutubeNet 17</strong></p>
<p>Youtube 在 Recsys 17 发表</p>
<p><img src="http://fanding.xyz/img/ZH14.jpg" alt="img"></p>
<p>相对于双塔结构，Youtube DNN 对物品 embedding、用户embedding 求平均然后 concat，用统一的（用户，物品）向量空间替代了原来的两个向量空间。</p>
<p><img src="http://fanding.xyz/img/ZH16.jpg" alt="img"></p>
<h2 id="entire-space-multi-task-model-18"><a class="markdownIt-Anchor" href="#entire-space-multi-task-model-18"></a> Entire Space Multi-Task Model 18’</h2>
<p>阿里在 KDD18 提出，为了解决 CVR 预估中样本选择偏差和数据系数问题，提出在全局空间建模（通过 pCTCVR 和 pCTR 来优化 CVR）和特征 Transform 方法来解决。</p>
<p>损失函数定义</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>(</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi></mrow></msub><mo separator="true">,</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>v</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mi>l</mi><mo>(</mo><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>)</mo><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mi>l</mi><mo>(</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant="normal">&amp;</mi><msub><mi>z</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">;</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>×</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">;</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>v</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">L(\theta_{ctr},\theta_{cvr}) = \sum_{i=1}^N l(y_i, f(x_i, \theta_{ctr})) + \sum_{i=1}^N l(y_i \&amp; z_i, f(x_i;\theta_{ctr}) \times f(x_i;\theta_{cvr}))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.8283360000000002em;"></span><span class="strut bottom" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mbin">+</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">&amp;</span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.04398em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018a/0eecfcca.png" alt="img"></p>
<h3 id="美团-multi-task-model"><a class="markdownIt-Anchor" href="#美团-multi-task-model"></a> 美团 Multi-Task Model</h3>
<p>广告预估场景中存在多个训练任务，比如CTR、CVR、交易额等。既考虑到多个任务之间的联系，又考虑到任务之间的差别，我们利用 Multi-Task Learning的思想，同时预估点击率、下单率，模型结构如下图所示：</p>
<p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018a/25c00d5c.png" alt="img"></p>
<h3 id="din-18"><a class="markdownIt-Anchor" href="#din-18"></a> DIN 18’</h3>
<p>阿里 KDD 2018 《Deep Interest Network for Click-Through Rate Prediction》</p>
<p>特点</p>
<ol>
<li>引入用户购-商品历史的 Attention 机制</li>
<li>dice 激活函数</li>
</ol>
<p>对 用户 - 广告 有特征：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mi>u</mi></msub><mo>(</mo><mi>A</mi><mo>)</mo><mo>=</mo><mi>f</mi><mo>(</mo><msub><mi>v</mi><mrow><mi>a</mi></mrow></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>e</mi><mi>H</mi></msub><mo>)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>H</mi></msubsup><mi>a</mi><mo>(</mo><msub><mi>e</mi><mi>j</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>a</mi></msub><mo>)</mo><msub><mi>e</mi><mi>j</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>H</mi></msubsup><msub><mi>w</mi><mi>j</mi></msub><msub><mi>e</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">V_u (A) = f(v_{a},e_1,e_2,...,e_H)=\sum_{j=1}^H a(e_j,v_a)e_j=\sum_{j=1}^Hw_j e_j
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.8283360000000006em;"></span><span class="strut bottom" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">u</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">A</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">a</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.08125em;">H</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000254801em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.08125em;">H</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">a</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000254801em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.08125em;">H</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<p>其中 A 是广告，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">V_u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">u</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是用户特征，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">e_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是用户-商品序列。</p>
<p>函数 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span></span></span></span> 是 Activation Unit，把输入 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1,x_2,x_2-x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.58333em;"></span><span class="strut bottom" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 拼接，输入 FC 层，输出权重 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">w_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 。</p>
<p><img src="https://camo.githubusercontent.com/f7aa2ff476e75c0a7f4f53686f6f0767ce495d63/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f33363135342f313534313939343933383138362d36356637656562632d623234362d346661312d396433352d3563616439653232613038642e706e67" alt="img"></p>
<p>Activation unit 可以针对候选广告，对相关度较高的用户行为商品embedding，给出较高的权重，如下图所示：</p>
<p><img src="https://camo.githubusercontent.com/6aa6099c85d394dab701dc64dd658d72eaa79919/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f363039382f313534323333373737373130312d65613934316136342d346636632d343932322d383136352d6238626364653537376239612e706e67" alt="img"></p>
<p><a href="https://www.infoq.cn/article/XA055tpFrprUy*0UBdCb" target="_blank" rel="noopener">https://www.infoq.cn/article/XA055tpFrprUy*0UBdCb</a></p>
<h3 id="dien-19"><a class="markdownIt-Anchor" href="#dien-19"></a> DIEN 19’</h3>
<p>阿里 AAAI 2019 《Deep Interest Evolution Network》</p>
<ol>
<li>引入循环网络（双层GRU），对用户历史事件序列建模，捕获用户兴趣演化</li>
<li>引入辅助 loss 帮助 GRU 学习</li>
</ol>
<p><img src="https://camo.githubusercontent.com/914b722021ba8f2c017add753a85744c15ff4365/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f33363135342f313534313939363430363830372d33376361326662332d373765312d346330352d396437312d3739313665643936646136322e706e67" alt="img"></p>
<h3 id="esmm-18"><a class="markdownIt-Anchor" href="#esmm-18"></a> ESMM 18’</h3>
<p>阿里 KDD2018</p>
<p>特点：</p>
<ol>
<li>pCTR pCVR 模型共享权制，解决 pCVR 样本选择有偏（SSB）、数据稀疏（DS）问题</li>
</ol>
<p>对比：</p>
<p>Oversampling：把正样本复制多分，缓解 DS 问题；</p>
<p>AMAN：把 All Missing As Negative，通过引入未点击未转化样本，部分解决 SSB 问题；</p>
<p>UNBIAS：</p>
<p>DIVISION：</p>
<p>损失函数：</p>
\begin{align}
L(\theta_{cvr}, \theta_{ctr}) = &\sum_{i=1}^N l(y_i, f(\textbf{x}_i;\theta_{ctr})) + \\&\sum_{i=1}^N l(y_i \& z_i, f(\textbf{x}_i;\theta_{ctr}) \times f(\textbf{x}_i;\theta_{cvr})) 
\end{align}

<p><img src="https://camo.githubusercontent.com/e330757cabd23dc23b86af76fe017630f53fc6db/687474703a2f2f617461322d696d672e636e2d68616e677a686f752e696d672d7075622e616c6979756e2d696e632e636f6d2f33353531393330373030353164393665626463653033383738376564396439332e706e67" alt="img"></p>
<h3 id="tdm"><a class="markdownIt-Anchor" href="#tdm"></a> TDM</h3>
<h3 id="crossmedia"><a class="markdownIt-Anchor" href="#crossmedia"></a> CrossMedia</h3>
<p>a.k.a. Deep Image CTR Model</p>
<p>CIKM 2017 Image Matters: Visually modeling user behaviors using Advanced Model Server 阿里  <a href="https://arxiv.org/pdf/1711.06505.pdf" target="_blank" rel="noopener">PDF</a></p>
<p><img src="https://pic1.zhimg.com/80/v2-107eed8fcd5b72f0bbe8464bd2471fc4_hd.jpg" alt="img"></p>
<p>创新点：</p>
<ol>
<li>将用户点击过的图像特征（与训练VGG的4096维输出）进行 attention pooling，对用户侧的视觉偏好建模（之前模型多用在物品侧）</li>
<li>AMS 架构解决计算瓶颈</li>
</ol>
<h3 id="rnn-ctr-19"><a class="markdownIt-Anchor" href="#rnn-ctr-19"></a> RNN CTR 19’</h3>
<p>KDD19 Click-Through Rate Prediction with the User Memory Network</p>
<p><img src="http://www.semocean.com/wp-content/uploads/2019/08/Screenshot_20190818_114444-1024x359.jpg" alt="img"></p>
<p><a href="http://www.semocean.com/tag/embedding/" target="_blank" rel="noopener">http://www.semocean.com/tag/embedding/</a></p>
<h3 id="autoint-19"><a class="markdownIt-Anchor" href="#autoint-19"></a> AutoInt 19’</h3>
<p>Automatic Feature Interaction Learning <a href="https://arxiv.org/pdf/1810.11921.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>相比于 DCN 和 xDeepFM 采用交叉网络 + DNN 的双路结构，AutoInt 直接采用了单路的模型结构，将原始特征Embedding之后，直接采用多层 Interacting Layer进行学习（作者在论文的实验部分也列出了AutoInt + DNN 的双路模型结构：AutoInt+）；借鉴了NLP模型中 Transformer的 Multi-head self-attention 机制，给模型的交叉特征引入了可解释性。</p>
<p><img src="https://pic4.zhimg.com/80/v2-2bcd969359e25cb761e83dbe7fd74df7_720w.jpg" alt="img"></p>
<img src="https://pic4.zhimg.com/v2-bc9273d3a93930afa65ee82265769347_b.jpg" alt="img" style="zoom:50%;">
<img src="https://pic4.zhimg.com/80/v2-ada85658bdd40c5e19c41fd76f424c0b_720w.jpg" alt="img" style="zoom:50%;">
<img src="https://pic1.zhimg.com/80/v2-6c6aa2c6395a51f764702cfac4403d68_1440w.jpg" alt="img" style="zoom: 50%;">
<p>以上是 single-head self-attention 结构，multi-head 由多个以上结构派生。</p>
<p>其中：</p>
\begin{align}
\alpha_{m,k}^{(h)} &= \frac{\exp(\psi^{(h)}(e_m,e_k))}{\sum_{l=1}^M \exp(\psi^{(h)}(e_m,e_l))} \\
\psi^{(h)}(e_m, e_k) &= <w_{query}^{(h)} e_m,="" w_{key}^{(h)}="" e_k=""> \\
\hat{e}_{m}^{(h)} &= \sum_{k=1}^{M} \alpha_{m,k}^{(h)} (W_{Value}^{(h)}e_k)
\end{align}

<p>其中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>m</mi></msub><mo>∈</mo><msup><mrow><mi mathvariant="double-struck">R</mi></mrow><mrow><mi>d</mi><mo>×</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">e_m \in \mathbb{R}^{d \times 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.849108em;"></span><span class="strut bottom" style="height:0.999108em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">R</span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">d</span><span class="mbin">×</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是 emb 向量，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mrow><mi>Q</mi><mi>u</mi><mi>e</mi><mi>r</mi><mi>y</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>K</mi><mi>e</mi><mi>y</mi></mrow></msub><msub><mi>e</mi><mi>m</mi></msub><mo>∈</mo><msup><mrow><mi mathvariant="double-struck">R</mi></mrow><mrow><msup><mi>d</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>×</mo><mi>d</mi></mrow></msup></mrow><annotation encoding="application/x-tex">W_{Query}, W_{Key}e_m \in \mathbb{R}^{d&#x27; \times d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.89488em;"></span><span class="strut bottom" style="height:1.180988em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">Q</span><span class="mord mathit">u</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">R</span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span class="mord mathit">d</span><span class="vlist"><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord scriptscriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">×</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>把输入emb 向量 d 维空间映射到 d’ 维空间。</p>
<p>对每个输入向量 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">e_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，每个 single-head 输出，是 Query 和 Keyword 向量的加权和。</p>
<p>对每个输入向量 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">e_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，多个 single-head 输出，拼接得到 multi-head 的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mover accent="true"><mrow><mi>e</mi></mrow><mo>^</mo></mover><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">\hat{e}_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit">e</span></span></span><span style="top:0em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> ：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mover accent="true"><mrow><mi>e</mi></mrow><mo>^</mo></mover><mi>m</mi></msub><mo>=</mo><msubsup><mover accent="true"><mrow><mi>e</mi></mrow><mo>^</mo></mover><mi>m</mi><mrow><mo>(</mo><mn>1</mn><mo>)</mo></mrow></msubsup><mo>⊕</mo><msubsup><mover accent="true"><mrow><mi>e</mi></mrow><mo>^</mo></mover><mi>m</mi><mrow><mo>(</mo><mn>1</mn><mo>)</mo></mrow></msubsup><mo>⊕</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>⊕</mo><msubsup><mover accent="true"><mrow><mi>e</mi></mrow><mo>^</mo></mover><mi>m</mi><mrow><mo>(</mo><mi>H</mi><mo>)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\hat{e}_m=\hat{e}_m^{(1)} \oplus \hat{e}_m^{(1)} \oplus ... \oplus \hat{e}_m^{(H)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.938em;"></span><span class="strut bottom" style="height:1.185em;vertical-align:-0.247em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">e</span></span></span><span style="top:0em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">e</span></span></span><span style="top:0em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">⊕</span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">e</span></span></span><span style="top:0em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">⊕</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mbin">⊕</span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">e</span></span></span><span style="top:0em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<p>加上恒残差连接加速训练：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>e</mi><mi>m</mi><mrow><mi>R</mi><mi>e</mi><mi>s</mi></mrow></msubsup><mo>=</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo>(</mo><msub><mover accent="true"><mrow><mi>e</mi></mrow><mo>^</mo></mover><mi>m</mi></msub><mo>+</mo><msub><mi>W</mi><mrow><mi>R</mi><mi>e</mi><mi>s</mi></mrow></msub><msub><mi>e</mi><mi>m</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">e_m^{Res} = ReLU(\hat{e}_m + W_{Res}e_m)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8913309999999999em;"></span><span class="strut bottom" style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">L</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">e</span></span></span><span style="top:0em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mrow><mi>R</mi><mi>e</mi><mi>s</mi></mrow></msub><mo>∈</mo><msup><mrow><mi mathvariant="double-struck">R</mi></mrow><mrow><msup><mi>d</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mi>H</mi><mo>×</mo><mi>d</mi></mrow></msup></mrow><annotation encoding="application/x-tex">W_{Res} \in \mathbb{R}^{d&#x27;H\times d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.89488em;"></span><span class="strut bottom" style="height:1.04488em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">R</span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span class="mord mathit">d</span><span class="vlist"><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord scriptscriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="mbin">×</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>  是投影矩阵，确保维度匹配。</p>
<p>把有输入向量的 multi-head res 输出向量 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>e</mi><mi>m</mi><mrow><mi>R</mi><mi>e</mi><mi>s</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">e_m^{Res}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8413309999999999em;"></span><span class="strut bottom" style="height:1.088331em;vertical-align:-0.247em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 拼接起来，得到输出层：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mi>y</mi></mrow><mo>^</mo></mover><mo>=</mo><mi>σ</mi><mo fence="false">(</mo><msup><mi>w</mi><mi>T</mi></msup><mo>(</mo><msubsup><mi>e</mi><mn>1</mn><mrow><mi>R</mi><mi>e</mi><mi>s</mi></mrow></msubsup><mo>⊕</mo><msubsup><mi>e</mi><mn>2</mn><mrow><mi>R</mi><mi>e</mi><mi>s</mi></mrow></msubsup><mo>⊕</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>⊕</mo><msubsup><mi>e</mi><mi>M</mi><mrow><mi>R</mi><mi>e</mi><mi>s</mi></mrow></msubsup><mo>)</mo><mo>+</mo><mi>b</mi><mo fence="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{y} = \sigma\big( w^T(e_1^{Res} \oplus e_2^{Res} \oplus ... \oplus e_M^{Res}) + b \big)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8913309999999999em;"></span><span class="strut bottom" style="height:1.2413409999999998em;vertical-align:-0.35001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:0em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">σ</span><span class="mord"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">(</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">⊕</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">⊕</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mbin">⊕</span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:0.247em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit">b</span><span class="mord"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">)</span></span></span></span></span></span></span></p>
<h3 id="dstn"><a class="markdownIt-Anchor" href="#dstn"></a> DSTN</h3>
<p>《Deep Spatio-Temporal neural Networks SIGKDD19》 <a href="https://arxiv.org/pdf/1906.03776.pdf" target="_blank" rel="noopener">PDF</a> 阿里营销平台</p>
<p>b 模型，在 DNN 基础上，引入<strong>辅助广告特征</strong>：空域 — 同页的上下文广告；时域 — 最近点击未点击的广告。</p>
<p>c 模型，将目标广告的 embedding 和辅助广告一起输入到 attention 结构中，产生权重 pooling 起来，学习目标广告于辅助广告的重要性交互。</p>
<img src="https://pic4.zhimg.com/v2-9eefb5bb8fbf762f82cd614feb91d35f_1200x500.jpg" alt="img" style="zoom: 67%;">
<h3 id="bst"><a class="markdownIt-Anchor" href="#bst"></a> BST</h3>
<p>《Behavior Sequence Transformer for E-commerce Recommendation in Alibaba 19》 <a href="https://arxiv.org/pdf/1905.06874.pdf" target="_blank" rel="noopener">PDF</a>  阿里搜索推荐组</p>
<p>问题：DIN 没有捕捉用户行为的连续性。</p>
<p>通过 Transformer Layer（仅 Encoding 部分），学习用户行为序列 item 与候选 item 的特征表达，输入三层 MLP学习特征的交互，最后输入 sigmoid 输出概率。</p>
<p>注：Transformer 来自《Attention Is All You Need》，抛弃传统 NLP 任务的 RNN 和 CNN 结构，通过 Attention + MLP 结构完成 encoder decoder 任务，并且融合了位置信息。</p>
<p>注：item 输入特征中，蓝色是物品特征（只需取 item_id 和 category_id）；红色是位置特征，模型学习位置编码（Positional Embedding）。</p>
<p>数据集合特点：用户行为丰富，淘宝 7 天数据，3亿用户，1千万物品，400亿样本，</p>
<p>效果：AUC 微小提升，CTR 显著提升</p>
<img src="https://picb.zhimg.com/80/v2-83603bac70ce5c70f21bfaade37e63ec_720w.jpg" alt="img" style="zoom:50%;">
<img src="https://picb.zhimg.com/80/v2-b3c0a3b076a3964b13390609c2a73aae_720w.jpg" alt="img">
<h3 id="umm"><a class="markdownIt-Anchor" href="#umm"></a> UMM</h3>
<p>《Click-Through Rate Prediction with the User Memory Network DLP-KDD19》<a href="https://arxiv.org/pdf/1907.04667.pdf" target="_blank" rel="noopener">PDF</a> <a href="https://github.com/rener1199/deep_memory" target="_blank" rel="noopener">git</a> 阿里营销平台</p>
<h3 id="deepmcp"><a class="markdownIt-Anchor" href="#deepmcp"></a> DeepMCP</h3>
<p>《Representation Learning-Assisted Click-Through Rate Prediction IJCAI19》<a href="https://arxiv.org/pdf/1906.04365.pdf" target="_blank" rel="noopener">PDF</a> 阿里营销平台</p>
<p>传统的 DNN 模型将特征 embedding 用全连接网络往上送，最终和 label 一起计算 loss 并优化，学习时更多地关注 label 和特征之间的相互关系，虽然也有神经元连接起到交叉作用，但是特征和特征之间的相互影响学习的较少。比如某个用户点了某个 item，模型学习的结果并不要求用户和 item 表达有相似性。目前有些可借鉴的网络结构，如 DSSM，会要求两个输入 item 有一定的相似性。因此我们借鉴了这种思路，并将现有的模型结构融合起来，使得 DNN 网络学习的同时，对 Embedding 的学习也使用一些辅助网络来强化。对应到我们的业务中，如用户和广告，如果有点击关系，是否能相似一些，用户点击序列中的广告，是否能学的相似一些。</p>
<img src="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf73AUlUhNfXWBdaUOPKMQnKXgp4Atsbbf5ZIC6SFEukTCOmiclDR7pqsw/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" style="zoom: 50%;">
<p>整个 DeepMCP 网络分为三个部分：一个是主网络，可以是任何的 DNN 网络结构，如 wide&amp;deep，DeepFM；两个辅助网络：匹配子网络和关联子网络。匹配子网络学习的是用户和广告的相关性 ( 类似 DSSM )，关联子网络是学习广告和广告的相关性 ( 类似 word2vec 和 graph embedding )，目标是希望整个网络既有好的预测能力，又有好的 feature embedding 表达能力，从而提升模型的泛化能力。MCP 模型还有一个优点，线上 inference 时， 只需要把主网络激活就可以了，其它部分不需要计算，对线上计算性能没有影响。</p>
<img src="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf7TeCnvu4Z20Vb9Dictz4a2evAuNBHScxAibnsGqGCiciaavSoicxV8odwcdQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" style="zoom: 50%;">
<img src="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf7BnZa3guBkDRP3mFl76uv8rgKbyj5ibP087f9W24YchicKPq57AjCKRmA/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" style="zoom: 50%;">
<img src="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf72zIYUP8TqWrLXRgbvm4kwGWTiav8Rbkib8SfRibUMwVvVOiaqTkoEhSbvw/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" style="zoom:50%;">
<img src="http://mmbiz.qpic.cn/mmbiz_jpg/7YJVBU9FXkVobBHQfiaHnkpick3eCClOf7fSnaSYwTgpCw1Ekb74YdOgnicOqNg0pdEicKyxLpqKez8862gEVUOkJA/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" style="zoom:50%;">
<p><a href="https://mp.weixin.qq.com/s?__biz=MzU3Njc2ODczNw==&amp;mid=2247483931&amp;idx=1&amp;sn=9c9b211c873c048f53a03f8123d6616b&amp;chksm=fd0f9d95ca781483bd8e064c7996cb5b5f5d1326ea74202ec85733ea4386f92aa8934ea62c69&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1590645254799&amp;sharer_shareid=aa9abf9bf34835862aec405f534107df&amp;rd2werd=1#wechat_redirect" target="_blank" rel="noopener">《深度时空网络、记忆网络与特征表达学习在 CTR 预估中的应用》</a> 秀武 阿里高级算法专家</p>
<h2 id="uicmimn-19"><a class="markdownIt-Anchor" href="#uicmimn-19"></a> UIC&amp;MIMN 19</h2>
<p>《Practice on Long Sequential User Behavior Modeling for Click-Through Rate Prediction》<a href="https://arxiv.org/pdf/1905.09248.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>MIMN借鉴了memory network的思想，用一个固定的memory矩阵对用户的兴趣信息进行存储。对于用户每一个新增的行为进行兴趣的encode后，写入其对应的memory slot中。在线计算某个用户CTR的时候使用当前最新的用户兴趣矩阵信息，在进行CTR的推断。这样的做法将长期兴趣建模和CTR预估两部分进行解耦，用户兴趣矩阵提前计算完毕，不会在对CTR预估计算带来latency瓶颈，同时在线需要通信和存储的内容也从原始行为序列变成了固定大小的memory矩阵。在这样的设计帮助下，我们实现了对<strong>1000</strong>量级的行为序列进行建模，并落地到了在线生产环境。但是这样的方案设计其实存在一些问题，其系统上带来的技术债暂且不表，算法上在目前的技术水平下存在一定的局限性。一个固定大小的memory 矩阵表达信息是有限的，如果我们想建模更长的用户行为序列，比如<strong>10000+</strong>，memory-based的方法会面临表达能力有限，难以过滤噪声，建模随时间信息遗忘的问题。UIC&amp;MIMN解耦了兴趣建模和在线CTR预估的计算，建模用户兴趣时模型无法获取和使用待预估的候选item的信息。</p>
<h2 id="sim-20"><a class="markdownIt-Anchor" href="#sim-20"></a> SIM 20</h2>
<p>《Search-based User Interest Modeling with Lifelong Sequential Behavior Data for Click-Through Rate Prediction》KDD19 阿里 <a href="https://arxiv.org/pdf/2006.05639.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>《Life-long兴趣建模视角CTR预估模型：Search-based Interest Model》周国睿 <a href="https://zhuanlan.zhihu.com/p/148416488" target="_blank" rel="noopener">知乎</a></p>
<p>SIM 旨在研发一个可以根据预估目标item信息对用户全生命周期行为进行search，获取该item相关信息的方法。稳重提出了两阶段的search模式：general search 和 exact search。从精度角度我们将搜索拆解为一个相对粗糙普适的搜索和一个更为具体精确的搜索。</p>
<p>SIM 给出了一个通用的 framwork 让我们可以给每个用户的所有行为都构建一个索引，在预估CTR的时候可以充分的考虑用户的所有行为表达。</p>
<p><img src="https://pic3.zhimg.com/80/v2-094bdca7184cf02020397df2a9abe67a_1440w.jpg" alt="img"></p>
<p><img src="https://pic4.zhimg.com/80/v2-2b62937c0c80ef66431df9c343bfb90b_1440w.jpg" alt="img"></p>
<h2 id="多任务学习"><a class="markdownIt-Anchor" href="#多任务学习"></a> 多任务学习</h2>
<h3 id="esmm"><a class="markdownIt-Anchor" href="#esmm"></a> ESMM</h3>
<p>pCTR pCTCVR 任务辅助 pCVR 学习，缓解 pCVR 数据选择偏差、稀疏的问题。</p>
<p>所有 user / item embedding lookup 结果，会  element-wise 加起来，再进行 concat，这样的设计利于特征扩展。</p>
<p>损失函数</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>(</mo><msub><mi>w</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>c</mi><mi>v</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>=</mo><msub><mo>∑</mo><mi>i</mi></msub><mi>L</mi><mo>(</mo><mi>y</mi><mo separator="true">,</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>)</mo><mo>+</mo><msub><mo>∑</mo><mi>i</mi></msub><mi>L</mi><mo>(</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant="normal">&amp;</mi><msub><mi>z</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">;</mo><msub><mi>w</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>∗</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">;</mo><msub><mi>w</mi><mrow><mi>c</mi><mi>v</mi><mi>r</mi></mrow></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">L(w_{ctr},w_{cvr})=\sum_i L(y, f(x_i, w_{ctr})) + \sum_i L(y_i\&amp;z_i, f(x_i;w_{ctr}) *f(x_i;w_{cvr}))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.0500050000000003em;"></span><span class="strut bottom" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">L</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mbin">+</span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">&amp;</span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.04398em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<img src="https://pic1.zhimg.com/80/v2-cb6163a762b848a15bb35b24f2e1af27_720w.jpg" alt="img" style="zoom:50%;">
<h3 id="esm2"><a class="markdownIt-Anchor" href="#esm2"></a> ESM^2</h3>
<p>《Entire Space Multi-Task Modeling via Post-Click Behavior Decomposition for Conversion Rate Prediction》Ali arxiv2019  <a href="https://arxiv.org/pdf/1910.07099.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>更多任务</p>
<img src="https://pic2.zhimg.com/80/v2-cb31e1f977b0e68c9df0e50019d848ce_720w.jpg" alt="img" style="zoom:50%;">
<h3 id="mose"><a class="markdownIt-Anchor" href="#mose"></a> MoSE</h3>
<p>《Multitask Mixture of Sequential Experts for User Activity Streams》Google KDD2020 <a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/63a48017f06cd046cbf97f158195e9d96e8b2205.pdf" target="_blank" rel="noopener">PDF</a> <a href="https://mp.weixin.qq.com/s/fiSu85iLgjcmpyp4YRoz7w" target="_blank" rel="noopener">深度传送门</a></p>
<p>本文主要研究了如何在多任务学习场景中针对用户行为序列进行建模，提出了一套新颖的模型框架 MoSE（Mixture of Sequential Experts）。在当前最新的MMoE多任务学习框架中使用LSTM针对用户行为序列进行显式建模。同时，本文也通过离线实验以及GMail的线上实验证明了本文的有效性。</p>
<h3 id="mmoe"><a class="markdownIt-Anchor" href="#mmoe"></a> MMoE</h3>
<p>《Modeling Task Relationships in Multi-task Learning with Multi-gate Mixture-of-Experts KDD18》<a href="https://dl.acm.org/doi/pdf/10.1145/3219819.3220007" target="_blank" rel="noopener">PDF</a></p>
<p>多任务学习常见结构：share-bottom 共用隐层，参数少，避免过拟合，但子任务差异很大效果不佳。</p>
<p>论文提出 MMoE 结构，通过 multi gates 和 mult experts，学习每类任务的表达，解决 shared-bottom 子任务差异大效果不佳的问题。</p>
<p>与 ESMM 不同，子任务之间无关联。</p>
<p><img src="https://pic4.zhimg.com/80/v2-c578c5e506e202483c64fdac94281d4f_720w.jpg" alt="img"></p>
<h3 id="snr"><a class="markdownIt-Anchor" href="#snr"></a> SNR</h3>
<p>《SNR: Sub-Network Routing for Flexible Parameter Sharing in Multi-task Learning AAAI19》<a href="https://www.aaai.org/ojs/index.php/AAAI/article/view/3788" target="_blank" rel="noopener">PDF</a></p>
<p>解决多任务学习问题，任务间相关性低时，shared-bottom 或 MMoE 等方法精度不高的问题。</p>
<h3 id="youtube-multitask-ranking-system"><a class="markdownIt-Anchor" href="#youtube-multitask-ranking-system"></a> YouTube Multitask Ranking System</h3>
<p>《Recommending What Video to Watch Next: A Multitask Ranking System RecSys19》 <a href="https://dl.acm.org/doi/pdf/10.1145/3298689.3346997" target="_blank" rel="noopener">PDF</a></p>
<p>解决：</p>
<ol>
<li>MMoE 视频推荐中的多任务目标：比如不仅需要预测用户是否会观看外，还希望去预测用户对于视频的评分，是否会关注该视频的上传者，否会分享到社交平台等。</li>
<li>Shallow Tower 预测偏置位置信息，输入 pCTR 任务：比如用户是否会点击和观看某个视频，并不一定是因为他喜欢，可能仅仅是因为它排在推荐页的最前面，这会导致训练数据产生位置偏置的问题。</li>
</ol>
<p><img src="https://pic1.zhimg.com/80/v2-aec2056823ac4e84ca30c2cb0c83be39_720w.jpg" alt="img"></p>
<h3 id="pfd"><a class="markdownIt-Anchor" href="#pfd"></a> PFD</h3>
<p>《Privileged Features Distillation at Taobao Recommendations KDD20》 <a href="https://arxiv.org/pdf/1907.05171.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>损失函数</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>min</mi><mrow><msub><mi>W</mi><mi>s</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>t</mi></msub></mrow></msub><mo>(</mo><mn>1</mn><mo>−</mo><mi>λ</mi><mo>)</mo><msub><mi>L</mi><mi>s</mi></msub><mo>(</mo><mi>y</mi><mo separator="true">,</mo><msub><mi>f</mi><mi>s</mi></msub><mo>(</mo><mi>X</mi><mo separator="true">;</mo><msub><mi>W</mi><mi>s</mi></msub><mo>)</mo><mo>)</mo><mo>+</mo><mi>λ</mi><msub><mi>L</mi><mi>d</mi></msub><mo>(</mo><msub><mi>f</mi><mi>t</mi></msub><mo>(</mo><msup><mi>X</mi><mo>∗</mo></msup><mo separator="true">,</mo><mi>X</mi><mo separator="true">;</mo><msub><mi>W</mi><mi>t</mi></msub><mo>)</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>s</mi></msub><mo>(</mo><mi>X</mi><mo separator="true">;</mo><msub><mi>W</mi><mi>s</mi></msub><mo>)</mo><mo>)</mo><mo>+</mo><msub><mi>L</mi><mi>t</mi></msub><mo>(</mo><mi>y</mi><mo separator="true">,</mo><msub><mi>f</mi><mi>t</mi></msub><mo>(</mo><msup><mi>X</mi><mo>∗</mo></msup><mo separator="true">,</mo><mi>X</mi><mo separator="true">;</mo><msub><mi>W</mi><mi>t</mi></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\min_{W_s,W_t}(1-\lambda) L_s(y, f_s(X;W_s)) + \lambda L_d(f_t(X^*,X;W_t), f_s(X;W_s)) + L_t(y, f_t(X^*,X;W_t))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.630439em;vertical-align:-0.880439em;"></span><span class="base displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:0.644331em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:2.7755575615628914e-17em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="mop">min</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit">λ</span><span class="mclose">)</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit">λ</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∗</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∗</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mpunct">;</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span></span></span></span> 是 student、teacher 模型原始 loss，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span> 是 student、teacher 模型的预估值。<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">X^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.688696em;"></span><span class="strut bottom" style="height:0.688696em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∗</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 是普通特征+优势特征，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> 是普通特征。</p>
<p>蒸馏方法通常训练老师，再固定老师权重训练学生；为加速，两个模型同时训练，通过调整 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">λ</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span> 先重点训练 teacher 模型，再逐渐增加 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">λ</span></span></span></span> 权重。</p>
<p>淘宝推荐系统架构</p>
<img src="https://pic4.zhimg.com/80/v2-228928089f16b82d1e5fd2016b7683fb_720w.jpg" alt="img" style="zoom:50%;">
<p>统一蒸馏：MD（模型蒸馏）与 PFD（优势特征蒸馏）结合，用精排 CTR 模型做老师，粗排模型做学生</p>
<p><img src="https://pic4.zhimg.com/80/v2-f21bd3e71e00f6cff30096208d3ec1fb_720w.jpg" alt="img"></p>
<p><img src="https://pic4.zhimg.com/80/v2-d1ab9004ab268a08b471632208267424_720w.jpg" alt="img"></p>
<h3 id="uw-loss"><a class="markdownIt-Anchor" href="#uw-loss"></a> UW Loss</h3>
<p>《Multi-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics CVPR18》<a href="http://openaccess.thecvf.com/content_cvpr_2018/papers/Kendall_Multi-Task_Learning_Using_CVPR_2018_paper.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>与固定权重损失 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><mo>∑</mo><msub><mi>w</mi><mi>i</mi></msub><msub><mi>L</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">L_{total}=\sum w_i L_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 相比，UW Loss 的权重是通过最小化损失函数学习得到的。</p>
<p>推导：令 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f^W(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8413309999999999em;"></span><span class="strut bottom" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> 为神经网络的输出值，定义概率模型（回归）</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo>(</mo><mi>y</mi><mi mathvariant="normal">∣</mi><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>=</mo><mi>N</mi><mo>(</mo><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">p(y|f^W(x)) = N(f^W(x), \sigma^2)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8913309999999999em;"></span><span class="strut bottom" style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">σ</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>定义概率模型（分类）</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo>(</mo><mi>y</mi><mi mathvariant="normal">∣</mi><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">p(y|f^W(x)) = Softmax(f^W(x))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8913309999999999em;"></span><span class="strut bottom" style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">t</span><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<p>定义多任务 likelihood</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo>(</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>K</mi></msub><mi mathvariant="normal">∣</mi><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>=</mo><mi>p</mi><mo>(</mo><msub><mi>y</mi><mn>1</mn></msub><mi mathvariant="normal">∣</mi><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi>p</mi><mo>(</mo><msub><mi>y</mi><mi>K</mi></msub><mi mathvariant="normal">∣</mi><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">p(y_1,...,y_K|f^W(x))=p(y_1|f^W(x)) ... p(y_K|f^W(x))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8913309999999999em;"></span><span class="strut bottom" style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<p>回归模型的多任务 log likelihood （Gaussian likelihood，假设概率模型服从高斯分布）</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mi>p</mi><mo>(</mo><msub><mi>y</mi><mi>K</mi></msub><mi mathvariant="normal">∣</mi><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>)</mo><mo>≈</mo><mo>−</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mn>2</mn><msup><mi>σ</mi><mn>2</mn></msup></mrow></mfrac><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>y</mi><mo>−</mo><msup><mi>f</mi><mi>W</mi></msup><mo>(</mo><mi>x</mi><mo>)</mo><mi mathvariant="normal">∣</mi><msup><mi mathvariant="normal">∣</mi><mn>2</mn></msup><mo>−</mo><mi>log</mi><mi>σ</mi></mrow><annotation encoding="application/x-tex">\log  p(y_K|f^W(x)) \approx -\frac{1}{2 \sigma^2}|| y - f^W(x)||^2 - \log \sigma
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.32144em;"></span><span class="strut bottom" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="base displaystyle textstyle uncramped"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mrel">≈</span><span class="mord">−</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">σ</span><span class="vlist"><span style="top:-0.289em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mord mathrm">∣</span><span class="mord mathrm">∣</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathrm">∣</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">σ</span></span></span></span></span></p>
<p>对两个回归任务 ，损失函数为</p>
\begin{align}
L(W,\sigma_1,\sigma_2) &=-\log p(y_1,y_2|f^W(x)) \\
&\approx \frac{1}{2\sigma_1^2}||y_1 - f^W(x)||^2 + \frac{1}{2\sigma_2^2}||y_2 - f^W(x)||^2 + \log \sigma_1 \sigma_2 \\ 
&= \frac{1}{2\sigma_1^2} L_1(W)+\frac{1}{2\sigma_2^2} L_2(W)+\log \sigma_1 \sigma_2
\end{align}

<p>对比固定权重损失</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><mo>∑</mo><msub><mi>w</mi><mi>i</mi></msub><msub><mi>L</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">L_{total}=\sum w_i L_i
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.05em;"></span><span class="strut bottom" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="op-symbol large-op mop" style="top:-0.000004999999999977245em;">∑</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<h3 id="帕累托最优"><a class="markdownIt-Anchor" href="#帕累托最优"></a> 帕累托最优</h3>
<p>《A Pareto-Efficient Algorithm for Multiple Objective Optimization in E-Commerce Recommendation RecSys19》<a href="http://yongfeng.me/attach/lin-recsys2019.pdf" target="_blank" rel="noopener">PDF</a></p>
<p>如何用模型自动寻找最优的目标权重参数组合，就是一个非常有价值的方向，目前最常用的方式是采用帕累托最优的方案来进行权重组合寻优，这是从经济学引入的技术方案，未来还有很大的发展空间。</p>
<h2 id="多模态信息融合"><a class="markdownIt-Anchor" href="#多模态信息融合"></a> 多模态信息融合</h2>
<p>加入 user / item 侧的音视频特征、图片特征。难点在于工程支撑，如何设计结构获取有效的特征表示。</p>
<p>《Collaborative Multi-modal deep learning for the personalized product retrieval in Facebook Marketplace》</p>
<p>《Image Matters: Visually modeling user behaviors using Advanced Model Server》</p>
<h2 id="实现"><a class="markdownIt-Anchor" href="#实现"></a> 实现</h2>
<p><a href="https://github.com/guoday/ctrNet-tool" target="_blank" rel="noopener">https://github.com/guoday/ctrNet-tool</a> (tensorflow layer API, criteo 数据集 dense 格式)</p>
<p><a href="https://github.com/shenweichen/DeepCTR" target="_blank" rel="noopener">https://github.com/shenweichen/DeepCTR</a> (tensorflow keras API)</p>
<p><a href="https://github.com/nzc/dnn_ctr" target="_blank" rel="noopener">https://github.com/nzc/dnn_ctr</a> (pytorch)</p>
<p><a href="https://github.com/lambdaji/tf_repos/tree/master/deep_ctr" target="_blank" rel="noopener">https://github.com/lambdaji/tf_repos/tree/master/deep_ctr</a> (tensorflow-1.12 Pyhton2.7 Estimator API，criteo 数据集 libsvm 格式，支持 TFServing 模型导出)</p>
<p><a href="https://github.com/lambdaji/tf_repos/tree/master/DeepMTL" target="_blank" rel="noopener">https://github.com/lambdaji/tf_repos/tree/master/DeepMTL</a> (ESMM tensorflow-1.12 Pyhton2.7 Estimator API ESMM，天池数据集，支持 TFServing 模型导出)</p>
<h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2>
<p><a href="https://zhuanlan.zhihu.com/p/40135103" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/40135103</a></p>
<p><a href="http://fanding.xyz/2018/05/01/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%8ECTR%E9%A2%84%E4%BC%B0,%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%8F%AC%E5%9B%9E%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%A8%A1%E5%9E%8B%E4%B8%B2%E8%AE%B2/" target="_blank" rel="noopener">fanding.xyz</a></p>
<p>深度学习在美团搜索广告排序的应用实践 <a href="https://tech.meituan.com/2018/06/07/searchads-dnn.html" target="_blank" rel="noopener">https://tech.meituan.com/2018/06/07/searchads-dnn.html</a></p>
<p>远程监督 <a href="https://blog.csdn.net/m0_38031488/article/details/79852238" target="_blank" rel="noopener">https://blog.csdn.net/m0_38031488/article/details/79852238</a></p>
<p>2019 腾讯广告冠军方案 <a href="https://zhuanlan.zhihu.com/p/73062485" target="_blank" rel="noopener">知乎</a></p>
<p>推荐系统中的注意力机制——阿里深度兴趣网络（DIN）<a href="https://zhuanlan.zhihu.com/p/51623339" target="_blank" rel="noopener">知乎</a></p>
<p><a href="http://www.semocean.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%EF%BC%8C%E5%8F%98%E7%8E%B0%E7%B3%BB%E7%BB%9Fctrcvr%E9%A2%84%E4%BC%B0%E7%AE%97%E6%B3%95%E6%BC%94%E8%BF%9B/" target="_blank" rel="noopener">semocean’s blog</a></p>
<p><a href="https://github.com/alibaba/x-deeplearning/wiki/XDL%E7%AE%97%E6%B3%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" target="_blank" rel="noopener">阿里 XDL 算法解决方案</a></p>
<p>DeepCTR：易用可扩展的深度学习点击率预测算法包 <a href="https://zhuanlan.zhihu.com/p/53231955" target="_blank" rel="noopener">知乎</a></p>
<p>TODO</p>
<p>漫谈深度学习时代点击率预估技术进展 朱小强 <a href="https://www.infoq.cn/article/XA055tpFrprUy*0UBdCb" target="_blank" rel="noopener">InfoQ</a></p>
<p><a href="https://mp.weixin.qq.com/s/MtnHYmPVoDAid9SNHnlzUw" target="_blank" rel="noopener">MLR</a> 阿里妈妈算法团队</p>
<p>详解阿里之Deep Interest Evolution Network(AAAI 2019) <a href="https://zhuanlan.zhihu.com/p/50758485" target="_blank" rel="noopener">知乎</a></p>
<p>CTR预估模型发展过程与关系图谱 <a href="https://zhuanlan.zhihu.com/p/104307718" target="_blank" rel="noopener">知乎</a></p>
<p>NLP 中的 Transformer 和 BERT <a href="https://zhuanlan.zhihu.com/p/53099098" target="_blank" rel="noopener">知乎</a></p>
</w_{query}^{(h)}>
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>本文有帮助？</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/img/wechatpay.png" alt="davidlau WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/14/bayesian/" rel="next" title="贝叶斯定理">
                <i class="fa fa-chevron-left"></i> 贝叶斯定理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/29/pctr/" rel="prev" title="pCTR">
                pCTR <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="davidlau" />
          <p class="site-author-name" itemprop="name">davidlau</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">64</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#xgb"><span class="nav-number">1.</span> <span class="nav-text"> XGB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gbdt-lr"><span class="nav-number">2.</span> <span class="nav-text"> GBDT + LR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fm"><span class="nav-number">3.</span> <span class="nav-text"> FM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#deepfm"><span class="nav-number">4.</span> <span class="nav-text"> DeepFM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#widedeep"><span class="nav-number">5.</span> <span class="nav-text"> Wide&amp;Deep</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dcn-17"><span class="nav-number">6.</span> <span class="nav-text"> DCN 17’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fnn-snn-pnn"><span class="nav-number">7.</span> <span class="nav-text"> FNN &amp; SNN &amp; PNN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nfm-17"><span class="nav-number">8.</span> <span class="nav-text"> NFM 17’</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nffm-18"><span class="nav-number">8.1.</span> <span class="nav-text"> NFFM 18’</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#afm-17"><span class="nav-number">9.</span> <span class="nav-text"> AFM 17’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#deepfm-17"><span class="nav-number">10.</span> <span class="nav-text"> DeepFM 17’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xdeepfm-18"><span class="nav-number">11.</span> <span class="nav-text"> xDeepFM 18’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#双塔模型"><span class="nav-number">12.</span> <span class="nav-text"> 双塔模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#entire-space-multi-task-model-18"><span class="nav-number">13.</span> <span class="nav-text"> Entire Space Multi-Task Model 18’</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#美团-multi-task-model"><span class="nav-number">13.1.</span> <span class="nav-text"> 美团 Multi-Task Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#din-18"><span class="nav-number">13.2.</span> <span class="nav-text"> DIN 18’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dien-19"><span class="nav-number">13.3.</span> <span class="nav-text"> DIEN 19’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#esmm-18"><span class="nav-number">13.4.</span> <span class="nav-text"> ESMM 18’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tdm"><span class="nav-number">13.5.</span> <span class="nav-text"> TDM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crossmedia"><span class="nav-number">13.6.</span> <span class="nav-text"> CrossMedia</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rnn-ctr-19"><span class="nav-number">13.7.</span> <span class="nav-text"> RNN CTR 19’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#autoint-19"><span class="nav-number">13.8.</span> <span class="nav-text"> AutoInt 19’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dstn"><span class="nav-number">13.9.</span> <span class="nav-text"> DSTN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bst"><span class="nav-number">13.10.</span> <span class="nav-text"> BST</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#umm"><span class="nav-number">13.11.</span> <span class="nav-text"> UMM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deepmcp"><span class="nav-number">13.12.</span> <span class="nav-text"> DeepMCP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uicmimn-19"><span class="nav-number">14.</span> <span class="nav-text"> UIC&amp;MIMN 19</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sim-20"><span class="nav-number">15.</span> <span class="nav-text"> SIM 20</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多任务学习"><span class="nav-number">16.</span> <span class="nav-text"> 多任务学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#esmm"><span class="nav-number">16.1.</span> <span class="nav-text"> ESMM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#esm2"><span class="nav-number">16.2.</span> <span class="nav-text"> ESM^2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mose"><span class="nav-number">16.3.</span> <span class="nav-text"> MoSE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mmoe"><span class="nav-number">16.4.</span> <span class="nav-text"> MMoE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#snr"><span class="nav-number">16.5.</span> <span class="nav-text"> SNR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#youtube-multitask-ranking-system"><span class="nav-number">16.6.</span> <span class="nav-text"> YouTube Multitask Ranking System</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pfd"><span class="nav-number">16.7.</span> <span class="nav-text"> PFD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uw-loss"><span class="nav-number">16.8.</span> <span class="nav-text"> UW Loss</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#帕累托最优"><span class="nav-number">16.9.</span> <span class="nav-text"> 帕累托最优</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多模态信息融合"><span class="nav-number">17.</span> <span class="nav-text"> 多模态信息融合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现"><span class="nav-number">18.</span> <span class="nav-text"> 实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reference"><span class="nav-number">19.</span> <span class="nav-text"> Reference</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">davidlau</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
